<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

    <!-- Google Fonts  -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext" rel="stylesheet" type="text/css">
    <!-- Bootstrap -->
    <link href="plugins/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <!-- NProgress -->
    <link href="plugins/nprogress/nprogress.css" rel="stylesheet">
    <!-- jQuery custom content scroller -->
    <link href="plugins/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css" rel="stylesheet" />
    <!-- Waves Effect Css -->
    <link href="plugins/node-waves/waves.css" rel="stylesheet" />
    <!-- Animation Css -->
    <link href="plugins/animate-css/animate.css" rel="stylesheet" />
    <!-- Sweet Alert 2 Plugin Js -->
    <link href="plugins/SweetAlert2/sweetalert2.min.css" rel="stylesheet" />
    <!-- Sweet Alert 2 Plugin Js -->
    <script src="plugins/SweetAlert2/sweetalert2.min.js"></script>
    <!-- Datatables -->
    <link href="plugins/datatables.net-bs/css/dataTables.bootstrap.css" rel="stylesheet">
    <link href="plugins/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="plugins/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="plugins/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="plugins/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="css/custom.css" rel="stylesheet">

</head>

<body class="nav-md ">
    <div class="container body">
        <div class="main_container">
            <!-- top navigation -->
            <div class="navheader">
                <div class="col-sm-12" align="center">
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="margin-bottom: 10px"><img src="images/logo.png" alt="logo" style="width:110px; height:40px"></div>
                        <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                        <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                        <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"><button type="button" id="syncroniser" class="btn btn-circle bg-footer "><i class="fas fa-share-square"></i></button></div>
                        <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"><button type="button" class="btn btn-circle bg-footer" onclick="go_home()"><i class="fas fa-map-marked-alt"></i></button></div>
                    </div>
                </div>
            </div>
            <br>
            <!-- /top navigation -->

            <!-- page content -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="page-title">
                    </div>
                    <div class="clearfix"></div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    Données collectées :
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <p class="text-muted font-13 m-b-30">

                                    </p>
                                    <div class="table-responsive">
                                        <table id="20202020" class="table">
                                            <thead>
                                                <tr>
                                                    <th>Projet</th>
                                                    <th>Agent </th>
                                                    <th>Zone</th>
                                                    <th>Formulaire</th>
                                                    <th>Données</th>

                                                    <th>geojson</th>
                                                    <th>function</th>
                                                </tr>
                                            </thead>
                                            <tbody id="table_id">
                                                <tr>

                                                    <!--   -->
                                                    <td>projet</td>
                                                    <td>agnet</td>
                                                    <td>zone</td>
                                                    <td>form</td>
                                                    <td>data</td>
                                                    <td>geojson</td>
                                                    <td>function</td>


                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row clearfix">
                                        <div class=".col-md-4 .col-md-offset-4">
                                            <div class="btn-group btn-group-justified" role="group" aria-label="...">
                                                <div class="btn-group" role="group">
                                                    <button id="delete_data" class="float-right btn bg-red" type="button"><i class="fas fa-trash"></i> &nbsp; Supprimer tous</button>
                                                </div>
                                                <div class="btn-group" role="group">
                                                    <button id="syncroniser" class="float-left btn bg-green" type="button"><i class="fas fa-share-square"></i>&nbsp; Synchroniser</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /page content -->
        </div>
    </div>

    <script type="text/javascript">
    </script>

    <!-- jQuery -->
    <script src="plugins/jquery/dist/jquery.min.js"></script>
    <!-- Datatables-->
    <script src="plugins/datatables.net/js/jquery.dataTables.js"></script>
    <script src="plugins/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="plugins/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="plugins/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="plugins/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
    <script src="plugins/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="plugins/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="plugins/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
    <script src="plugins/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
    <script src="plugins/pdfmake/build/vfs_fonts.js"></script>
    <!-- Bootstrap -->
    <script src="plugins/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="plugins/nprogress/nprogress.js"></script>
    <!-- jQuery custom content scroller -->
    <script src="plugins/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="js/custom.js"></script>
    <!-- Waves Effect Plugin Js -->
    <script src="plugins/node-waves/waves.js"></script>
    <!-- Select Plugin Js -->
    <script src="plugins/bootstrap-select/js/bootstrap-select.js"></script>
    <!-- Sweet Alert 2 Plugin Js -->
    <script src="plugins/SweetAlert2/sweetalert2.min.js"></script>
    <!-- Cordova -->
    <script src="cordova.js"></script>

    <script>
        $(document).ready(function() {
            //   $('#example').DataTable();
        });
    </script>

    <!-- ouvrir la base de donnee-->
    <!-- sqlite 
    <script src="js/sqlite.js"></script>-->

    <!-- recuperation des donnees dans la base de donnees -->
    <script>
        function go_home() {
            url = 'index.html';
            location.replace(url);
        }
        $(document).ready(function() {
            setTimeout(function() {
                //alert("Hello");

                $('#20202020').addClass("table-bordered table-striped table-hover dt-responsive display nowrap jambo_table");
                $('#20202020').DataTable();
            }, 1000);

            var myDB;
            //Open Database Connection
            document.addEventListener("deviceready", onDeviceReady, false);

            function onDeviceReady() {
                myDB = window.sqlitePlugin.openDatabase({
                    name: "mySQLite.db",
                    location: 'default'
                });

                $("#table_id").html("");
                myDB.transaction(function(transaction) {
                    transaction.executeSql('SELECT * FROM data', [], function(tx, results) {
                        var len = results.rows.length,
                            i;
                        // $("#rowCount").html(len);
                        for (i = 0; i < len; i++) {
                            $("#table_id").append("<tr><td>" + results.rows.item(i).nom_projet + "</td><td>" + results.rows.item(i).nom_agent + "</td><td>" + results.rows.item(i).nom_zone + "</td><td>" + results.rows.item(i).nom_form + "</td><td>" + results.rows.item(i).data + "</td><td>" + results.rows.item(i).zone + "</td>  <td><button type='button' id='preview_zone' class='btn btn-circle bg-footer'><i class='fas fa-map'></i></button><button type='button' id='preview_data' class='btn btn-circle bg-footer'><i class='fas fa-clipboard-list'></i></button><button type='button' id='delete_row' class='btn btn-circle bg-footer'><i class='fas fa-trash'></i></button></td></tr>");
                        }
                    }, null);
                });
            }


            $("#delete_data").click(function() {

                myDB.transaction(function(transaction) {
                    var executeQuery = "DROP TABLE  IF EXISTS data";
                    transaction.executeSql(executeQuery, [],
                        function(tx, result) {
                            swal({
                                position: 'top-end',
                                type: 'success',
                                title: 'Table deleted successfully.',
                                showConfirmButton: false,
                                timer: 1500
                            })
                        },
                        function(error) {
                            alert('Error occurred while droping the table.');
                        }
                    );
                });
                setTimeout(function() {

                    url = 'data.html';

                    location.replace(url);

                }, 500);

            });

            $("#syncroniser").click(function() {
                myDB.transaction(function(transaction) {
                    transaction.executeSql('SELECT * FROM data', [], function(tx, results) {
                        var len = results.rows.length,
                            i;
                        var id;
                        var supprimer_sqlite = [];
                        // $("#rowCount").html(len);
                        for (i = 0; i < len; i++) {
                            //alert("id " + results.rows.item(i).id + "\n projet " + results.rows.item(i).nom_projet + "\n agent " + results.rows.item(i).nom_agent + "\n zone" + results.rows.item(i).nom_zone + "\n form " + results.rows.item(i).nom_form + "\n data " + results.rows.item(i).data + "\n zone" + results.rows.item(i).zone + "");
                            id = results.rows.item(i).id;
                            $.ajax({
                                type: 'POST',
                                async: false,


                                url: 'http://192.168.0.118/php/add_data.php',
                                data: {
                                    'nom_projet': results.rows.item(i).nom_projet,
                                    'nom_agent': results.rows.item(i).nom_agent,
                                    'nom_zone': results.rows.item(i).nom_zone,
                                    'nom_form': results.rows.item(i).nom_form,
                                    'data': results.rows.item(i).data,
                                    'zone': results.rows.item(i).zone
                                },
                                beforeSend: function() {
                                    // alert("befor send");

                                },
                                success: function(response) {
                                    if (response == 2) {

                                        // alert("succes" + id);
                                        supprimer_sqlite.push(id);
                                        /* myDB.transaction(function(transaction) {
                                             var executeQuery = "DELETE FROM data where id=?";
                                             transaction.executeSql(executeQuery, [id],
                                                 //On Success
                                                 function(tx, result) {
                                                     alert('Delete successfully');
                                                 },
                                                 //On Error
                                                 function(error) {
                                                     alert('Something went Wrong');
                                                 });
                                         });*/






                                        // swal("Done !", "Un nouveau agent est ajouté avec succés", "success");
                                        /* $("#form_add_user").trigger("reset");
                        $("#submitButton_add").html('Ajouter un autre');
                        $("#agent").html('Ajouter un autre agent');
*/

                                    } else {
                                        alert("erreur");
                                        //swal("ERREUUUUUUR", "Ajouter un autre agent", "error");
                                        //$("#submitButton_add").html('Sauvegarder');
                                    }
                                }

                            });



                        }

                        // for (i = 1; i < supprimer_sqlite.length; i++) {
                        supprimer_sqlite.forEach(function(i) {
                            // alert("element " + i + "\n");
                            var idx = i;

                            myDB.transaction(function(transaction) {
                                var executeQuery = "DELETE FROM data where id=?";
                                transaction.executeSql(executeQuery, [idx],
                                    //On Success
                                    function(tx, result) {

                                        //  alert('Delete successfully' + idx);
                                    },
                                    //On Error
                                    function(error) {
                                        alert('Something went Wrong');
                                    });
                            });

                        })

                        // }


                    }, null);
                });

                /*swal({
                    position: 'top-end',
                    type: 'success',
                    title: 'vos donnes bien syncroniser ',
                    showConfirmButton: false,
                    timer: 1500
                });*/
                swal({
                    title: 'Syncronisation',
                    text: "Vos données sont bien syncronisées !",
                    type: 'success',
                    showCancelButton: false,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'oky!'
                }).then((result) => {
                    if (result.value) {


                        setTimeout(
                            function() {


                                url = 'data.html';

                                location.replace(url);
                            }, 100);
                    }
                })


            });

        });
    </script>





    <script>
    </script>

</body>

</html>